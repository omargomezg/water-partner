create table temp_table_reading
(
    rut     varchar(10),
    serial  integer,
    lectura integer
);
insert into temp_table_reading
values ('9221930-8', 21092, 200),
       ('11704413-0', 86039, 403),
       ('10442516-K', 11726, 0),
       ('5408740-3', 2822, 357),
       ('6888803-4', 64489, 2052),
       ('9459857-5', 12959, 297),
       ('5765067-2', 21034, 1261),
       ('6254322-1', 63178, 50),
       ('3791182-8', 21037, 2540),
       ('8992882-6', 21020, 423),
       ('3223281-7', 21033, 483),
       ('7322295-8', 67760, 716),
       ('7879367-8', 3937, 1043),
       ('3767718-3', 100695, 64),
       ('8483237-5', 21031, 1401),
       ('7343525-0', 4854, 1233),
       ('5683851-1', 12071, 398),
       ('3767718-3', 21093, 300),
       ('9550856-1', 21032, 3566),
       ('7830650-5', 67754, 574),
       ('9435302-5', 6942, 34),
       ('5413779-6', 21035, 3289),
       ('11063696-2', 17999, 170),
       ('8419115-9', 6949, 686),
       ('7729609-3', 21091, 494),
       ('10599552-0', 20682, 260),
       ('113242787', 14147, 1689),
       ('10256452-9', 14143, 1500),
       ('8723458-4', 5430, 564),
       ('7877490-8', 6984, 434),
       ('13519671-1', 4811, 448),
       ('48175348-1', 16939, 1750),
       ('8254712-6', 67752, 2860),
       ('3542741-4', 20960, 948),
       ('5985278-7', 16935, 780),
       ('5516050-3', 21017, 1010),
       ('4910079-5', 15677, 1158),
       ('9334750-1', 4630, 0),
       ('6636920-K', 5435, 1233),
       ('594888-3', 20951, 667),
       ('7235086-3', 92103, 624),
       ('4990554-8', 20952, 1254),
       ('12049031-1', 3195, 325),
       ('10148047-K', 20959, 397),
       ('4838540-0', 1860, 713),
       ('10402792-K', 13854, 0),
       ('9291660-K', 56570, 24),
       ('8529926-3', 2001, 113),
       ('5244378-4', 20989, 1294),
       ('8886705-K', 994315, 80),
       ('15759770-1', 67772, 1308),
       ('9334260-7', 63123, 30),
       ('4209470-6', 20957, 165),
       ('6627033-5', 20955, 321),
       ('6291154-9', 21053, 1653),
       ('5847936-5', 67707, 2110),
       ('25770722-9', 4383, 755),
       ('25770722-9', 4384, 1886),
       ('6485478-9', 20953, 261),
       ('3087277-0', 20985, 1917),
       ('3389052-4', 2155, 6608),
       ('9049710-3', 16890, 1129),
       ('6689521-1', 18497, 966),
       ('4979319-7', 22814, 43),
       ('4932040-8', 269011, 2850),
       ('81380500-6', 112610, 73),
       ('8281158-K', 164638, 59),
       ('9456841-2', 20932, 1229),
       ('4698968-6', 20934, 986),
       ('3845584-2', 20933, 2272),
       ('3845584-2', 20935, 1027),
       ('73741900-2', 4196, 429),
       ('12148046-8', 20940, 4796),
       ('10757253-8', 19316, 127),
       ('9061354-5', 101962, 583),
       ('69200100-1', 2149, 48217),
       ('69200100-1', 401276, 13685),
       ('69200100-1', 8282, 2187),
       ('4158579-K', 20990, 2439),
       ('7407609-2', 70975, 385),
       ('18887471-1', 14767, 89),
       ('11591973-3', 2014, 61),
       ('14081194-7', 31047, 391),
       ('7067869-1', 22809, 128),
       ('15262211-2', 21108, 2723),
       ('8981616-5', 3593, 1195),
       ('10172321-6', 21110, 3357),
       ('10172321-6', 50173, 583),
       ('8461325-8', 8444, 386),
       ('4727567-9', 16888, 1062),
       ('7455147-5', 20964, 4583),
       ('12747046-4', 3220, 2648),
       ('7703435-8', 67711, 318),
       ('9108990-4', 52758, 19),
       ('14280476-6', 11335, 806),
       ('8681413-7', 22815, 77),
       ('12747048-0', 83296, 1503),
       ('3542386-9', 21036, 455),
       ('4403700-9', 20982, 1985),
       ('9725094-4', 20172, 261),
       ('11063855-8', 6672, 274),
       ('6128346-3', 15671, 14),
       ('7657850-8', 107040, 1151),
       ('9261201-5', 4114, 253),
       ('8977076-9', 4963, 132),
       ('5298004-6', 2167, 202),
       ('6845775-0', 1876, 396),
       ('10358656-9', 1384, 125),
       ('3760354-6', 67755, 261),
       ('9592531-6', 10009, 420),
       ('8233951-5', 68310, 235),
       ('4201485-0', 21094, 836),
       ('6073692-8', 67709, 1575),
       ('6423645-8', 21007, 794),
       ('6394619-2', 21099, 285),
       ('5364573-9', 16882, 5334),
       ('3803930-2', 20987, 1231),
       ('10684168-3', 54912, 133),
       ('10331142-K', 41099, 337),
       ('11866990-8', 28125, 9),
       ('14081229-3', 32880, 24),
       ('6907259-3', 164637, 241),
       ('8878649-1', 14501, 5),
       ('10877541-6', 20525, 3),
       ('10335463-3', 11336, 74),
       ('693099-5', 30575, 3),
       ('7613981-4', 4120, 213),
       ('3540401-5', 67781, 223),
       ('5181200-K', 101972, 59),
       ('11324493-3', 8503, 92),
       ('4840134-4', 853, 218),
       ('4412618-4', 107043, 96),
       ('10971455-0', 8152, 246),
       ('4840134-4', 21052, 369),
       ('6293333-2', 54074, 64),
       ('6907259-3', 54069, 178),
       ('13319203-4', 21088, 2712),
       ('4583531-6', 21018, 1347),
       ('4932640-8', 20963, 1061),
       ('4574899-5', 16933, 433),
       ('5702253-1', 16916, 1120),
       ('5593045-7', 16912, 463),
       ('4373018-5', 16936, 282),
       ('7121031-6', 15680, 46),
       ('7166610-7', 6077, 139),
       ('6532758-9', 6084, 82),
       ('5602771-8', 6162, 147),
       ('8682198-2', 48065, 540),
       ('3904467-6', 54272, 399),
       ('12431565-4', 101277, 156),
       ('8487431-1', 5434, 399),
       ('13116830-6', 26707, 55),
       ('5505127-5', 21010, 360),
       ('5640789-0', 21002, 2342),
       ('10941847-1', 54273, 292),
       ('16476831-7', 31060, 28),
       ('126115717', 165240, 25),
       ('7346874-4', 16937, 554),
       ('4129410-8', 20958, 2922),
       ('4498509-8', 54276, 18),
       ('6414652-1', 1280, 1083),
       ('15293774-1', 17128, 182),
       ('8797872-9', 9182, 810),
       ('8922667-8', 72002, 22),
       ('9557268-5', 67753, 392),
       ('7398568-4', 67778, 287),
       ('8393533-2', 11806, 47),
       ('7972317-7', 21011, 90),
       ('9465240-5', 8157, 1192),
       ('3899665-7', 3219, 293),
       ('5214372-1', 114231, 808),
       ('9546270-7', 21107, 2263),
       ('11656989-2', 9007, 432),
       ('5833525-8', 16932, 195),
       ('4802475-0', 16938, 4075),
       ('6034302-0', 16934, 269),
       ('2498315-3', 20956, 2687),
       ('13916989-8', 8521, 8),
       ('11323885-2', 63738, 723),
       ('17511744-K', 173597, 379),
       ('6702442-7', 4848, 1888),
       ('13846866-6', 4119, 79),
       ('10870802-6', 70366, 923),
       ('10641592-7', 16186, 75),
       ('10019739-1', 100131, 3066),
       ('', 11010, 307),
       ('9135666-K', 100696, 124),
       ('10061739-0', 78099, 13),
       ('7996116-7', 16885, 472),
       ('11063814-0', 73097, 42),
       ('4855788-0', 3286, 240),
       ('8916844-9', 16886, 135),
       ('5354190-9', 20167, 0),
       ('4740961-6', 21095, 619),
       ('3661958-9', 67706, 217),
       ('8305584-7', 16708, 795),
       ('4644507-4', 21101, 324),
       ('3930954-8', 20939, 1157),
       ('8751595-8', 28129, 241),
       ('10082878-2', 20167, 298),
       ('11592465-6', 20977, 1088),
       ('4032683-9', 21001, 3),
       ('7446510-2', 16881, 631),
       ('16853765-7', 2138, 744),
       ('6574923-8', 2156, 534),
       ('15853406-1', 69183, 361),
       ('5791294-K', 10893, 446),
       ('4406603-3', 16889, 418),
       ('9044819-6', 214025, 413),
       ('8801140-6', 118787, 21),
       ('10870166-8', 100600, 561),
       ('11704892-6', 33346, 204),
       ('3758543-2', 16887, 617),
       ('10923754-K', 1882, 152),
       ('8942602-2', 26716, 88),
       ('7604586-0', 1136, 125),
       ('8991547-3', 20937, 5460),
       ('14280506-5', 54271, 374),
       ('4343274-5', 8164, 332),
       ('9423113-2', 101283, 453),
       ('7020717-6', 20938, 2457),
       ('7076283-8', 1719, 471),
       ('7321239-1', 10520, 412),
       ('4826969-9', 69189, 342),
       ('7244495-7', 101964, 36),
       ('8696018-4', 101966, 322),
       ('5918697-3', 26708, 10),
       ('9185187-3', 20991, 5544),
       ('9185187-3', 14054, 681),
       ('10158214-0', 101209, 266),
       ('9609627-5', 101208, 105),
       ('17034910-5', 6673, 353),
       ('8258700-4', 101205, 363),
       ('16320431-2', 6671, 330),
       ('6644399-K', 2802, 233),
       ('7728237-8', 197046, 1097),
       ('66896323', 1243, 221),
       ('9004669-1', 85273, 104),
       ('7233728-K', 2275, 790),
       ('11703949-8', 9011, 33),
       ('6686310-7', 2903, 45),
       ('6565929-8', 71085, 404),
       ('5487854-0', 120253, 105),
       ('13282303-0', 164636, 94),
       ('13846677-9', 164632, 68),
       ('8017363-6', 16707, 1450),
       ('4928495-0', 11331, 121),
       ('10127000-9', 11687, 276),
       ('3022145-1', 21013, 2457),
       ('7405522-2', 21057, 1719),
       ('12130449-K', 21060, 645),
       ('10094952-0', 3242, 227),
       ('6408555-7', 21056, 2568),
       ('4723534-0', 21056, 874),
       ('10838585-5', 20971, 710),
       ('10833725-7', 89702, 395),
       ('8413946-7', 31400, 814),
       ('9091542-8', 31396, 61),
       ('11590788-3', 31599, 56),
       ('5930733-9', 24446, 308),
       ('10518399-2', 19455, 73),
       ('12201027-9', 11338, 299),
       ('10461284-9', 172003, 7),
       ('8928379-5', 9008, 223),
       ('3669576-5', 1853, 3325),
       ('7929638-4', 21106, 1972),
       ('11592554-7', 4631, 182),
       ('6888807-7', 61731, 459),
       ('11678072-0', 173592, 70),
       ('865771-8', 57007, 2013),
       ('9068459-0', 56999, 1370),
       ('15422301-0', 56973, 1784),
       ('15422301-0', 71082, 577),
       ('7142922-9', 107047, 1589),
       ('5151242-2', 56998, 2411),
       ('5151242-2', 16706, 605),
       ('7552872-2', 120173, 148),
       ('14281027-1', 8153, 2306),
       ('14384588-5', 165248, 381),
       ('5157159-2', 22027912, 282),
       ('7665036-5', 67702, 103),
       ('10625310-2', 8102, 239),
       ('5155971-7', 16706, 3119),
       ('3161950-1', 57002, 642),
       ('9193323-3', 23795, 1129),
       ('5716050-5', 6947, 133),
       ('5001216-6', 57040, 290),
       ('4264560-5', 57060, 986),
       ('5618484-8', 21766, 928),
       ('5618484-8', 102068461, 218),
       ('10703361-0', 116183, 448),
       ('5012815-6', 102081121, 547),
       ('4420514-9', 112612, 118),
       ('15531096-0', 4437, 4),
       ('5757907-2', 4353, 87),
       ('15531096-0', 35550, 1057),
       ('7389030-6', 67775, 1598),
       ('5583619-1', 57001, 562),
       ('6252465-0', 20980, 931),
       ('6804684-K', 22821, 9),
       ('6252465-0', 120176, 38),
       ('5172966-8', 1883, 105),
       ('10251174-3', 164633, 22),
       ('4567051-1', 9018, 104),
       ('4056325-3', 9066, 246),
       ('10468606-0', 4502, 94),
       ('9837046-3', 16914, 2437),
       ('9837046-3', 8273, 846),
       ('14281983-K', 16911, 675),
       ('6958194-3', 16918, 6075),

       ('4240147-1', 1102, 90),
       ('8791198-5', 1193, 0),
       ('9446107-3', 20973, 1390),
       ('5551590-5', 16920, 242),
       ('14351931-7', 16915, 228),
       ('5486894-4', 2143, 62),
       ('10649279-4', 1985, 1194),
       ('9318524-2', 85259, 21),
       ('7678017-K', 1334, 62),
       ('2484271-1', 16919, 17),
       ('3118573-1', 3286, 1991),
       ('6532199-8', 8867, 1328),
       ('4399237-6', 21103, 1075),
       ('5980059-0', 21084, 1530),
       ('5499520-2', 21081, 856),
       ('5916398-1', 70959, 62),
       ('4063363-4', 21084, 1396),
       ('4497554-8', 21083, 1172),
       ('4902866-0', 21082, 504),
       ('6651908-2', 21016, 1244),
       ('5423478-3', 107009132, 1426),
       ('7194594-4', 90116, 1233),
       ('6469012-4', 4873, 479),
       ('6888788-7', 5432, 287),
       ('6148353-5', 101210, 296),
       ('7598602-5', 4493, 2066),
       ('11324213-2', 1175, 121),
       ('8188050-6', 5276, 137),
       ('10090798-4', 1794, 51),
       ('6519306-K', 10018, 788),
       ('6747987-4', 21088, 1660),
       ('4934990-9', 21090, 3336),
       ('10562969-9', 21086, 510),
       ('8363231-7', 7083, 351),
       ('6553596-3', 21087, 492),
       ('14281982-1', 4745, 275),
       ('8859225-5', 3939, 197),
       ('14282306-3', 101219, 1149),
       ('3821538-8', 16710, 1863),
       ('10320098-9', 28130, 15),
       ('4037836-7', 11333, 76),
       ('2768964-7', 20978, 2328),
       ('7469485-3', 23793, 3782),
       ('6636939-0', 1768, 2279),
       ('6636939-0', 73859, 115),
       ('9169388-7', 26710, 440),
       ('12747030-8', 1800, 102),
       ('9221187-8', 20997, 828),
       ('8321244-6', 56974, 2700),
       ('4945922-K', 4449, 392),
       ('7067869-1', 112601, 332),
       ('5114897-5', 2140, 430),
       ('8159598-4', 101979, 128),
       ('12431241-8', 110397, 49),
       ('48160036-7', 15573, 254),
       ('15523016-9', 5575, 140),
       ('7225637-9', 65972, 25),
       ('8759582-K', 4640, 47),
       ('6404050-2', 1764, 304),
       ('6859849-4', 122611, 404),
       ('3385035-2', 40362, 3208),
       ('12865469-0', 165247, 527),
       ('10954618-6', 11340, 416),
       ('5553228-1', 63739, 595),
       ('11425544-0', 11500, 106),
       ('12748006-0', 6674, 264),
       ('7157396-6', 26708, 144),
       ('6327579-4', 20099, 101),
       ('8791484-4', 2993, 1173),
       ('11709932-6', 11200, 61),
       ('109241237', 40939, 838),
       ('14157069-2', 30377, 360),
       ('8013236-0', 53200, 19),
       ('11590730-1', 73861, 126),
       ('8938797-3', 85441, 606),
       ('7454620-K', 73855, 22),
       ('10408655-1', 83291, 297),
       ('4864255-1', 21004, 1486),
       ('9552876-7', 41096, 116),
       ('4720590-5', 20974, 419),
       ('4541297-0', 20999, 1127),
       ('8611242-6', 78479, 701),
       ('10543794-3', 8154, 596),
       ('4939589-2', 112614, 331),
       ('8251158-K', 15678, 10976),
       ('7242679-7', 56985, 826),
       ('5680018-2', 56969, 636),
       ('4217505-6', 20993, 236),
       ('6656119-4', 6946, 169),
       ('6421826-3', 20996, 1699),
       ('8875836-6', 285, 214),
       ('5939392-8', 286, 158),
       ('5269430-2', 287, 1011),
       ('4843227-1', 1878, 742),
       ('10641681-8', 5433, 298),
       ('10693649-8', 23799, 288),
       ('7469485-3', 3228, 334),
       ('9607310-7', 8327, 615),
       ('5505116-K', 21000, 338),
       ('3857886-3', 16709, 720),
       ('9076233-8', 13849, 843),
       ('13522672-6', 100130, 126),
       ('6168548-0', 1767, 445),
       ('6665110-5', 5438, 1289),
       ('9968534-4', 1303, 291),
       ('11324908-2', 30690, 61),
       ('12512113-6', 30378, 564),
       ('7569617-5', 1359, 302),
       ('7331809-2', 3289, 398),
       ('8147387-0', 52760, 208),
       ('15316595-5', 14503, 97),
       ('9220872-9', 13858, 854),
       ('6626146-8', 10014, 885),
       ('10208522-1', 13445, 371),
       ('6469636-', 13850, 267),
       ('7068794-1', 6155, 566),
       ('6408169-1', 13848, 153),
       ('6408548-4', 13847, 404),
       ('13200193-6', 306, 370),
       ('12200704-9', 307, 554),
       ('6931175-K', 14142, 512),
       ('5298319-4', 13846, 875),
       ('8384377-2', 10851, 2184),
       ('5737766-6', 112608, 712),
       ('6947611-2', 8272, 1201),
       ('15292731-2', 466, 17),
       ('8050255-8', 67779, 419),
       ('9220872-9', 16706, 260),
       ('4072593-8', 21015, 581),
       ('9309715-7', 30376, 516),
       ('9107285-8', 85721, 82),
       ('6169930-9', 120163, 71),
       ('13814438-8', 70956, 59),
       ('15293649-4', 172021, 0),
       ('5726047-5', 70958, 148),
       ('11325403-3', 20963, 36),
       ('6899492-6', 20976, 1946),
       ('10708390-1', 20994, 181),
       ('5726047-5', 4746, 343),
       ('10687726-2', 10011, 292),
       ('6236878-0', 21058, 218),
       ('8104102-4', 10010, 197),
       ('4235999-8', 21098, 1421),
       ('5231970-6', 21014, 702),
       ('4915184-3', 12079, 0),
       ('8698388-5', 21105, 201),
       ('5138655-8', 9385, 60),
       ('14280585-5', 9385, 76),
       ('11324576-K', 9001, 303),
       ('5598778-5', 112613, 320),
       ('5384926-1', 172080, 21),
       ('10093073-0', 67710, 413),
       ('9013343-8', 67757, 433),
       ('5579516-K', 21005, 462),
       ('5579516-K', 57005, 1159),
       ('5152048-3', 23793, 424),
       ('11592047-2', 57004, 257),
       ('6211844-K', 57006, 949),
       ('7634111-7', 11339, 89),
       ('5920043-7', 11332, 1609),
       ('9117945-8', 12068, 333),
       ('1622044-K', 21109, 272),
       ('14441299-0', 21102, 497),
       ('13116830-6', 41106, 110),
       ('13321011-3', 4567, 218),
       ('6676154-1', 20163, 107),
       ('19319798-1', 61395, 1060),
       ('8892536-K', 22813, 0),
       ('8488764-1', 85634, 884),
       ('6412807-8', 8392, 580),
       ('6412807-8', 56978, 339),
       ('8658931-1', 15679, 127),
       ('7143678-0', 20932, 302),
       ('9237928-0', 56978, 396),
       ('7340075-9', 85275, 37),
       ('8345552-7', 21006, 1148),
       ('13707346-3', 4112, 273),
       ('7498631-0', 56988, 560),
       ('6968227-8', 2023, 562),
       ('8258090-5', 20936, 395),
       ('3829824-0', 56988, 194),
       ('9051897-6', 21797, 222),
       ('6968227-8', 16703, 36),
       ('13492177-3', 14062, 434),
       ('6636940-4', 9397, 241),
       ('5919670-7', 1334, 1640),
       ('1352396-3', 10700, 141),
       ('4961477-2', 83298, 70),
       ('16127608-1', 5577, 141),
       ('6413077-3', 73060, 89),
       ('8932556-8', 122616, 509),
       ('8834131-8', 8103, 163),
       ('4990958-6', 4852, 329),
       ('5880058-6', 16483, 442),
       ('6180540-0', 23798, 320),
       ('9067174-K', 56989, 120),
       ('5268247-9', 23797, 242),
       ('8760145-5', 21104, 282),
       ('9423473-5', 3180, 380),
       ('6325002-3', 23800, 2333),
       ('9786842-5', 8317, 1268),
       ('7232872-8', 5431, 2423),
       ('7803590-0', 8328, 747),
       ('2808975-9', 67773, 110),
       ('10772667-5', 173586, 19),
       ('7353660-K', 26713, 276),
       ('9158981-8', 26714, 461),
       ('4548230-8', 5710, 121),
       ('9791858-7', 4498, 124),
       ('7372976-9', 67683, 2319),
       ('4174588-6', 7568, 283),
       ('6041953-1', 1987, 340),
       ('7144637-9', 56990, 2593),
       ('9167681-8', 67761, 79),
       ('4646226-2', 3235, 177),
       ('6148203-3', 23794, 189),
       ('6483878-4', 56977, 744),
       ('6180540-0', 56984, 93),
       ('8136363-3', 56971, 125),
       ('4613573-3', 56987, 148),
       ('4613573-3', 67708, 880),
       ('7454218-2', 722009, 68),
       ('9414626-7', 56981, 1350),
       ('6395048-3', 120766, 76),
       ('9607710-7', 104968, 126);

DO
$$
    declare
        t_curs record;
        period_id bigint;
        watermeter_id bigint;
    begin
        for t_curs in
            select *
            from temp_table_reading
            loop
                perform 1 from watermeter where serial = t_curs.serial;
                if FOUND then
                    if found then
                        select id into watermeter_id from watermeter where serial=    t_curs.serial;
                        insert into consumption (reading, created, reading_date, cutoff_date, watermeter_id, period_id) values
                                                (t_curs.lectura, NOW(), NOW(), null, watermeter_id, 1);
                    end if;
                end if;
            end loop;

    end
$$
language 'plpgsql';

drop table temp_table_reading;